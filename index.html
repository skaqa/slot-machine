<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Slot Machine - Probability Weighted</title>
<style>
  body { 
    background: #222; 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    font-family: 'Segoe UI', sans-serif;
    color: white;
  }
  
  .scoreboard { margin-top: 20px; font-size: 24px; color: gold; }
  .status { height: 30px; margin: 10px; font-weight: bold; }

  .machine { display: flex; gap: 15px; margin-bottom: 20px; background: #444; padding: 20px; border-radius: 20px; border: 4px solid #666; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
  
  .reel {
    width: 100px; 
    height: 100px; 
    border: 3px solid #222;
    background: #000; 
    overflow: hidden; 
    position: relative;
    font-size: 60px;
    border-radius: 10px;
  }

  .strip {
    position: absolute;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .symbol {
    height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  button {
    padding: 15px 40px;
    font-size: 24px;
    cursor: pointer;
    background: #ff4757;
    color: white;
    border: none;
    font-weight: bold;
    border-radius: 50px;
    box-shadow: 0 4px #c0392b;
    text-transform: uppercase;
  }
  button:active { transform: translateY(2px); box-shadow: 0 2px #c0392b; }
  button:disabled { background: #666; box-shadow: none; cursor: not-allowed; }
</style>
</head>
<body>

<div class="scoreboard">Points: <span id="total-score">0</span></div>
<div class="status" id="status-msg">Try your luck!</div>

<div class="machine">
  <div class="reel"><div class="strip" id="r1"></div></div>
  <div class="reel"><div class="strip" id="r2"></div></div>
  <div class="reel"><div class="strip" id="r3"></div></div>
</div>

<button id="spin-btn" onclick="spin()">SPIN</button>

<script>
// 1. Symbol Configuration
// We define unique symbols and their scores
const symbolData = [
  { img: "ðŸ’", score: 10,  weight: 40 }, // Most common (40% chance)
  { img: "ðŸ‹", score: 20,  weight: 25 }, // 25% chance
  { img: "ðŸ””", score: 50,  weight: 15 }, // 15% chance
  { img: "7ï¸âƒ£", score: 100, weight: 12 }, // 12% chance
  { img: "â­", score: 500, weight: 8 }   // Rarest (8% chance)
];

// Create a flat array of unique symbols for UI generation
const uniqueSymbols = symbolData.map(s => s.img);

// 2. Setup Reels (Visuals)
document.querySelectorAll(".strip").forEach(strip => {
  const content = [];
  for(let i=0; i<15; i++) content.push(...uniqueSymbols); // Repeat for long scrolling
  
  content.forEach(s => {
    const div = document.createElement('div');
    div.className = 'symbol';
    div.innerText = s;
    strip.appendChild(div);
  });
});

let totalScore = 0;
const symbolHeight = 100;

// 3. Weighted Random Function
function getWeightedRandomSymbol() {
  // Calculate total weight (100 in this case)
  const totalWeight = symbolData.reduce((sum, s) => sum + s.weight, 0);
  let random = Math.random() * totalWeight;
  
  for (const s of symbolData) {
    if (random < s.weight) return s;
    random -= s.weight;
  }
}

function spin() {
  const spinBtn = document.getElementById('spin-btn');
  const statusElem = document.getElementById('status-msg');
  
  spinBtn.disabled = true;
  statusElem.innerText = "Spinning...";
  statusElem.style.color = "white";
  
  const results = [];

  document.querySelectorAll(".strip").forEach((strip, i) => {
    // Reset position instantly
    strip.style.transition = 'none';
    strip.style.transform = `translateY(0px)`;
    strip.offsetHeight; 

    // CHOOSE RESULT BASED ON WEIGHT
    const selected = getWeightedRandomSymbol();
    results.push(selected);

    // Find where that symbol lives in the unique list to stop the reel there
    const landingIndex = uniqueSymbols.indexOf(selected.img);
    
    // Animate: (Spin through many sets + land on index)
    const extraRotations = 10 + (i * 2); 
    const totalMove = (extraRotations * uniqueSymbols.length + landingIndex) * symbolHeight;

    strip.style.transition = `transform ${3 + i * 0.5}s cubic-bezier(0.15, 0, 0.15, 1)`;
    strip.style.transform = `translateY(-${totalMove}px)`;
  });

  // Check results after last reel stops
  setTimeout(() => {
    checkWin(results);
    spinBtn.disabled = false;
  }, 4000);
}

function checkWin(results) {
  const statusElem = document.getElementById('status-msg');
  const scoreElem = document.getElementById('total-score');
  
  const r1 = results[0].img;
  const r2 = results[1].img;
  const r3 = results[2].img;

  if (r1 === r2 && r2 === r3) {
    const winAmount = results[0].score;
    totalScore += winAmount;
    
    statusElem.innerText = `JACKPOT! ${r1} matched! +${winAmount} pts`;
    statusElem.style.color = "gold";
    scoreElem.innerText = totalScore;
  } else {
    statusElem.innerText = "No match, try again!";
    statusElem.style.color = "#888";
  }
}
</script>

</body>
</html>
